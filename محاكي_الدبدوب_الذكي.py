#!/usr/bin/env python3
"""
๐งธ ูุญุงูู ุงูุฏุจุฏูุจ ุงูุฐูู - ูุณุฎุฉ ุงุญุชุฑุงููุฉ
=====================================
ูุญุงูู ESP32 ูุงูู ูุน ูุงุฌูุฉ ุชูุงุนููุฉ ุงุญุชุฑุงููุฉ
ุชุฌุฑุจุฉ ุญููููุฉ ูุฃูู ุงุดุชุฑูุช ุงูุฏุจุฏูุจ ูู ุงููุญู!
"""

import tkinter as tk
from tkinter import ttk, messagebox, font
import asyncio
import threading
import time
import uuid
import json
from datetime import datetime
from typing import Dict, Any
import httpx

# ุฅุนุฏุงุฏุงุช ุงูุฏุจุฏูุจ
RENDER_URL = "https://ai-teddy-bear.onrender.com"
DEVICE_ID = f"TEDDY_{uuid.uuid4().hex[:8].upper()}"

class ูุญุงูู_ุงูุฏุจุฏูุจ_ุงูุฐูู:
    """
    ูุญุงูู ุงูุฏุจุฏูุจ ุงูุฐูู ุงูุงุญุชุฑุงูู
    ============================
    ูุญุงูู ุฌููุน ูุธุงุฆู ESP32 ุงูุญููููุฉ:
    - ุงุณุชุดุนุงุฑ ุงูููุณ
    - ุงูุชุนุฑู ุนูู ุงูุตูุช  
    - ุงูุงุณุชุฌุงุจุฉ ุงูุฐููุฉ
    - LED ูุชุนุฏุฏ ุงูุฃููุงู
    - ููุจุฑ ุงูุตูุช
    - ุงูุจุทุงุฑูุฉ
    - WiFi
    """
    
    def __init__(self):
        # ูุนูููุงุช ุงูุฌูุงุฒ
        self.device_id = DEVICE_ID
        self.server_url = RENDER_URL
        self.client = httpx.AsyncClient(timeout=30.0)
        
        # ุญุงูุฉ ุงูุฏุจุฏูุจ
        self.ุญุงูุฉ_ุงูุทุงูุฉ = False  # ูุทูุฃ/ูุดุบู
        self.ุญุงูุฉ_ุงูุงุชุตุงู = False  # ูุชุตู/ุบูุฑ ูุชุตู
        self.ุญุงูุฉ_ุงูุฏุจุฏูุจ = "ูุงุฆู"  # ูุงุฆูุ ูุณุชูุนุ ูููุฑุ ูุชุญุฏุซุ ุณุนูุฏุ ุญุฒูู
        self.ูุณุชูู_ุงูุจุทุงุฑูุฉ = 85
        self.ููุฉ_WiFi = -45
        
        # ูุคุดุฑุงุช ุงูุฌูุงุฒ
        self.led_ููู = "ุฃุญูุฑ"
        self.ุตูุช_ูุณุชูู = 70
        self.ุญุณุงุณูุฉ_ุงูููุณ = True
        self.ูุถุน_ุงูููู = False
        
        # ุฅูุดุงุก ุงููุงุฌูุฉ
        self.ุงูุดุงุก_ุงููุงูุฐุฉ_ุงูุฑุฆูุณูุฉ()
        self.ุงูุดุงุก_ูุงุฌูุฉ_ุงูุฏุจุฏูุจ()
        self.ุงูุดุงุก_ููุญุฉ_ุงูุชุญูู()
        self.ุงูุดุงุก_ููุทูุฉ_ุงููุญุงุฏุซุฉ()
        self.ุจุฏุก_ุงูุฑุณูู_ุงููุชุญุฑูุฉ()
        
        print(f"๐งธ ูุญุงูู ุงูุฏุจุฏูุจ ุงูุฐูู ุจุฏุฃ!")
        print(f"๐ ูุนุฑู ุงูุฌูุงุฒ: {self.device_id}")

    def ุงูุดุงุก_ุงููุงูุฐุฉ_ุงูุฑุฆูุณูุฉ(self):
        """ุฅูุดุงุก ุงููุงูุฐุฉ ุงูุฑุฆูุณูุฉ ูููุญุงูู"""
        self.root = tk.Tk()
        self.root.title("๐งธ ูุญุงูู ุงูุฏุจุฏูุจ ุงูุฐูู - ESP32 Professional")
        self.root.geometry("1000x800")
        self.root.configure(bg='#1e3a8a')
        self.root.resizable(True, True)
        
        # ุฎุท ุนุฑุจู
        try:
            self.ุฎุท_ุนุฑุจู = font.Font(family="Arial Unicode MS", size=12)
            self.ุฎุท_ุนููุงู = font.Font(family="Arial Unicode MS", size=18, weight="bold")
        except:
            self.ุฎุท_ุนุฑุจู = font.Font(family="Arial", size=12)
            self.ุฎุท_ุนููุงู = font.Font(family="Arial", size=18, weight="bold")
        
        # ุดุฑูุท ุงูุนููุงู
        ุนููุงู_ุงุทุงุฑ = tk.Frame(self.root, bg='#1e40af', height=80)
        ุนููุงู_ุงุทุงุฑ.pack(fill='x', pady=5)
        ุนููุงู_ุงุทุงุฑ.pack_propagate(False)
        
        tk.Label(
            ุนููุงู_ุงุทุงุฑ,
            text="๐งธ ุฏุจุฏูุจู ุงูุฐูู - ูุญุงูู ESP32",
            font=self.ุฎุท_ุนููุงู,
            fg='white',
            bg='#1e40af'
        ).pack(pady=20)

    def ุงูุดุงุก_ูุงุฌูุฉ_ุงูุฏุจุฏูุจ(self):
        """ุฅูุดุงุก ูุงุฌูุฉ ุงูุฏุจุฏูุจ ุงูุชูุงุนููุฉ"""
        # ุงูุฅุทุงุฑ ุงูุฑุฆูุณู
        ุงูุฅุทุงุฑ_ุงูุฑุฆูุณู = tk.Frame(self.root, bg='#e0f2fe')
        ุงูุฅุทุงุฑ_ุงูุฑุฆูุณู.pack(fill='both', expand=True, padx=10, pady=5)
        
        # ุฅุทุงุฑ ุงูุฏุจุฏูุจ
        ุฅุทุงุฑ_ุงูุฏุจุฏูุจ = tk.Frame(ุงูุฅุทุงุฑ_ุงูุฑุฆูุณู, bg='#81c784', relief='raised', bd=3)
        ุฅุทุงุฑ_ุงูุฏุจุฏูุจ.pack(side='left', fill='both', expand=True, padx=5)
        
        # ูุฌู ุงูุฏุจุฏูุจ
        self.canvas_ุงููุฌู = tk.Canvas(
            ุฅุทุงุฑ_ุงูุฏุจุฏูุจ,
            width=400,
            height=400,
            bg='#d7ccc8',
            highlightthickness=0
        )
        self.canvas_ุงููุฌู.pack(pady=20)
        
        # ุฑุณู ุงููุฌู
        self.ุฑุณู_ูุฌู_ุงูุฏุจุฏูุจ()
        
        # ุญุงูุฉ ุงูุฏุจุฏูุจ
        self.ุชุณููุฉ_ุงูุญุงูุฉ = tk.Label(
            ุฅุทุงุฑ_ุงูุฏุจุฏูุจ,
            text="๐ด ุงูุฏุจุฏูุจ ูุงุฆู",
            font=self.ุฎุท_ุนููุงู,
            bg='#81c784',
            fg='#2e7d32'
        )
        self.ุชุณููุฉ_ุงูุญุงูุฉ.pack(pady=10)
        
        # ูุนูููุงุช ุงูุฌูุงุฒ
        ุฅุทุงุฑ_ูุนูููุงุช = tk.Frame(ุฅุทุงุฑ_ุงูุฏุจุฏูุจ, bg='#81c784')
        ุฅุทุงุฑ_ูุนูููุงุช.pack(pady=10)
        
        tk.Label(
            ุฅุทุงุฑ_ูุนูููุงุช,
            text=f"๐ ูุนุฑู ุงูุฌูุงุฒ: {self.device_id}",
            font=self.ุฎุท_ุนุฑุจู,
            bg='#81c784'
        ).pack()
        
        tk.Label(
            ุฅุทุงุฑ_ูุนูููุงุช,
            text=f"๐ ุงูุฎุงุฏู: {self.server_url}",
            font=self.ุฎุท_ุนุฑุจู,
            bg='#81c784'
        ).pack()

    def ุฑุณู_ูุฌู_ุงูุฏุจุฏูุจ(self):
        """ุฑุณู ูุฌู ุงูุฏุจุฏูุจ ุญุณุจ ุงูุญุงูุฉ"""
        canvas = self.canvas_ุงููุฌู
        canvas.delete("all")
        
        # ุงูุฑุฃุณ
        canvas.create_oval(50, 50, 350, 350, fill='#8d6e63', outline='#5d4037', width=3)
        
        # ุงูุฃุฐููู ูุน LED
        ููู_led = self.get_led_color()
        canvas.create_oval(80, 30, 140, 90, fill=ููู_led, outline='#5d4037', width=2)
        canvas.create_oval(260, 30, 320, 90, fill=ููู_led, outline='#5d4037', width=2)
        
        # ุงูุนููู ุญุณุจ ุงูุญุงูุฉ
        if self.ุญุงูุฉ_ุงูุฏุจุฏูุจ == "ูุงุฆู":
            # ุนููู ูุบููุฉ
            canvas.create_arc(130, 150, 170, 180, start=0, extent=180, fill='black', width=3)
            canvas.create_arc(230, 150, 270, 180, start=0, extent=180, fill='black', width=3)
        elif self.ุญุงูุฉ_ุงูุฏุจุฏูุจ == "ูุณุชูุน":
            # ุนููู ูุชูุจูุฉ
            canvas.create_oval(130, 150, 170, 190, fill='black')
            canvas.create_oval(230, 150, 270, 190, fill='black')
            canvas.create_oval(145, 160, 155, 170, fill='white')
            canvas.create_oval(245, 160, 255, 170, fill='white')
        elif self.ุญุงูุฉ_ุงูุฏุจุฏูุจ == "ูููุฑ":
            # ุนููู ุชูุธุฑ ูุฃุนูู
            canvas.create_oval(130, 140, 170, 180, fill='black')
            canvas.create_oval(230, 140, 270, 180, fill='black')
            canvas.create_oval(145, 145, 155, 155, fill='white')
            canvas.create_oval(245, 145, 255, 155, fill='white')
        elif self.ุญุงูุฉ_ุงูุฏุจุฏูุจ == "ูุชุญุฏุซ":
            # ุนููู ุณุนูุฏุฉ
            canvas.create_arc(130, 150, 170, 180, start=0, extent=180, fill='black', width=2)
            canvas.create_arc(230, 150, 270, 180, start=0, extent=180, fill='black', width=2)
        elif self.ุญุงูุฉ_ุงูุฏุจุฏูุจ == "ุณุนูุฏ":
            # ุนููู ูุจุชุณูุฉ
            canvas.create_arc(130, 150, 170, 180, start=0, extent=180, fill='black', width=2)
            canvas.create_arc(230, 150, 270, 180, start=0, extent=180, fill='black', width=2)
        
        # ุงูุฃูู
        canvas.create_oval(190, 200, 210, 220, fill='black')
        
        # ุงููู ุญุณุจ ุงูุญุงูุฉ
        if self.ุญุงูุฉ_ุงูุฏุจุฏูุจ == "ูุงุฆู":
            canvas.create_arc(180, 240, 220, 270, start=0, extent=180, fill='black', width=2)
        elif self.ุญุงูุฉ_ุงูุฏุจุฏูุจ == "ูุชุญุฏุซ":
            canvas.create_oval(180, 240, 220, 280, fill='#c62828', outline='black', width=2)
        elif self.ุญุงูุฉ_ุงูุฏุจุฏูุจ == "ุณุนูุฏ":
            canvas.create_arc(160, 230, 240, 290, start=0, extent=180, outline='black', width=4)
        else:
            canvas.create_arc(170, 235, 230, 280, start=0, extent=180, outline='black', width=3)
        
        # ุชุฃุซูุฑุงุช ุฎุงุตุฉ
        if self.ุญุงูุฉ_ุงูุฏุจุฏูุจ == "ูุณุชูุน":
            # ููุฌุงุช ุตูุชูุฉ
            canvas.create_oval(70, 20, 150, 100, outline='yellow', width=3, dash=(5, 5))
            canvas.create_oval(250, 20, 330, 100, outline='yellow', width=3, dash=(5, 5))
        elif self.ุญุงูุฉ_ุงูุฏุจุฏูุจ == "ูููุฑ":
            # ููุงุนุงุช ุชูููุฑ
            canvas.create_oval(320, 80, 340, 100, outline='lightblue', width=2)
            canvas.create_oval(340, 60, 355, 75, outline='lightblue', width=2)
            canvas.create_oval(350, 45, 360, 55, outline='lightblue', width=2)

    def get_led_color(self):
        """ุงูุญุตูู ุนูู ููู LED ุญุณุจ ุงูุญุงูุฉ"""
        if not self.ุญุงูุฉ_ุงูุทุงูุฉ:
            return '#424242'  # ุฑูุงุฏู (ูุทูุฃ)
        elif not self.ุญุงูุฉ_ุงูุงุชุตุงู:
            return '#f44336'  # ุฃุญูุฑ (ุบูุฑ ูุชุตู)
        elif self.ุญุงูุฉ_ุงูุฏุจุฏูุจ == "ูุณุชูุน":
            return '#2196f3'  # ุฃุฒุฑู (ูุณุชูุน)
        elif self.ุญุงูุฉ_ุงูุฏุจุฏูุจ == "ูููุฑ":
            return '#ff9800'  # ุจุฑุชูุงูู (ูููุฑ)
        elif self.ุญุงูุฉ_ุงูุฏุจุฏูุจ == "ูุชุญุฏุซ":
            return '#9c27b0'  # ุจููุณุฌู (ูุชุญุฏุซ)
        elif self.ุญุงูุฉ_ุงูุฏุจุฏูุจ == "ุณุนูุฏ":
            return '#4caf50'  # ุฃุฎุถุฑ (ุณุนูุฏ)
        else:
            return '#4caf50'  # ุฃุฎุถุฑ ุงูุชุฑุงุถู

    def ุงูุดุงุก_ููุญุฉ_ุงูุชุญูู(self):
        """ุฅูุดุงุก ููุญุฉ ุงูุชุญูู ุงูุฌุงูุจูุฉ"""
        ููุญุฉ_ุงูุชุญูู = tk.Frame(self.root, bg='#37474f', width=250)
        ููุญุฉ_ุงูุชุญูู.pack(side='right', fill='y', padx=5, pady=5)
        ููุญุฉ_ุงูุชุญูู.pack_propagate(False)
        
        # ุนููุงู ููุญุฉ ุงูุชุญูู
        tk.Label(
            ููุญุฉ_ุงูุชุญูู,
            text="๐๏ธ ููุญุฉ ุงูุชุญูู",
            font=self.ุฎุท_ุนููุงู,
            fg='white',
            bg='#37474f'
        ).pack(pady=20)
        
        # ุฒุฑ ุงูุทุงูุฉ
        self.ุฒุฑ_ุงูุทุงูุฉ = tk.Button(
            ููุญุฉ_ุงูุชุญูู,
            text="๐ ุชุดุบูู ุงูุฏุจุฏูุจ",
            font=self.ุฎุท_ุนุฑุจู,
            bg='#4caf50',
            fg='white',
            width=20,
            height=2,
            command=self.ุชุจุฏูู_ุงูุทุงูุฉ
        )
        self.ุฒุฑ_ุงูุทุงูุฉ.pack(pady=10)
        
        # ุฒุฑ ุงูุงุชุตุงู
        self.ุฒุฑ_ุงูุงุชุตุงู = tk.Button(
            ููุญุฉ_ุงูุชุญูู,
            text="๐ ุงุชุตุงู ุงูุณุญุงุจุฉ",
            font=self.ุฎุท_ุนุฑุจู,
            bg='#2196f3',
            fg='white',
            width=20,
            command=self.ุงุฎุชุจุงุฑ_ุงูุงุชุตุงู,
            state='disabled'
        )
        self.ุฒุฑ_ุงูุงุชุตุงู.pack(pady=5)
        
        # ุฒุฑ ุงูููุณ
        self.ุฒุฑ_ุงูููุณ = tk.Button(
            ููุญุฉ_ุงูุชุญูู,
            text="๐ ููุณ ุงูุฏุจุฏูุจ",
            font=self.ุฎุท_ุนุฑุจู,
            bg='#ff9800',
            fg='white',
            width=20,
            command=self.ููุณ_ุงูุฏุจุฏูุจ,
            state='disabled'
        )
        self.ุฒุฑ_ุงูููุณ.pack(pady=5)
        
        # ูุคุดุฑุงุช ุงูุญุงูุฉ
        ุฅุทุงุฑ_ุงููุคุดุฑุงุช = tk.Frame(ููุญุฉ_ุงูุชุญูู, bg='#37474f')
        ุฅุทุงุฑ_ุงููุคุดุฑุงุช.pack(pady=20, fill='x')
        
        tk.Label(
            ุฅุทุงุฑ_ุงููุคุดุฑุงุช,
            text="๐ ูุคุดุฑุงุช ุงูุฌูุงุฒ",
            font=self.ุฎุท_ุนุฑุจู,
            fg='white',
            bg='#37474f'
        ).pack()
        
        # ูุณุชูู ุงูุจุทุงุฑูุฉ
        self.ุชุณููุฉ_ุงูุจุทุงุฑูุฉ = tk.Label(
            ุฅุทุงุฑ_ุงููุคุดุฑุงุช,
            text=f"๐ ุงูุจุทุงุฑูุฉ: {self.ูุณุชูู_ุงูุจุทุงุฑูุฉ}%",
            font=self.ุฎุท_ุนุฑุจู,
            fg='white',
            bg='#37474f'
        )
        self.ุชุณููุฉ_ุงูุจุทุงุฑูุฉ.pack(pady=2)
        
        # ููุฉ WiFi
        self.ุชุณููุฉ_wifi = tk.Label(
            ุฅุทุงุฑ_ุงููุคุดุฑุงุช,
            text=f"๐ถ WiFi: {self.ููุฉ_WiFi} dBm",
            font=self.ุฎุท_ุนุฑุจู,
            fg='white',
            bg='#37474f'
        )
        self.ุชุณููุฉ_wifi.pack(pady=2)
        
        # ุญุงูุฉ LED
        self.ุชุณููุฉ_led = tk.Label(
            ุฅุทุงุฑ_ุงููุคุดุฑุงุช,
            text=f"๐ก LED: {self.led_ููู}",
            font=self.ุฎุท_ุนุฑุจู,
            fg='white',
            bg='#37474f'
        )
        self.ุชุณููุฉ_led.pack(pady=2)
        
        # ุฅุนุฏุงุฏุงุช ูุชูุฏูุฉ
        ุฅุทุงุฑ_ุงูุฅุนุฏุงุฏุงุช = tk.Frame(ููุญุฉ_ุงูุชุญูู, bg='#37474f')
        ุฅุทุงุฑ_ุงูุฅุนุฏุงุฏุงุช.pack(pady=20, fill='x')
        
        tk.Label(
            ุฅุทุงุฑ_ุงูุฅุนุฏุงุฏุงุช,
            text="โ๏ธ ุงูุฅุนุฏุงุฏุงุช",
            font=self.ุฎุท_ุนุฑุจู,
            fg='white',
            bg='#37474f'
        ).pack()
        
        # ูุณุชูู ุงูุตูุช
        tk.Label(
            ุฅุทุงุฑ_ุงูุฅุนุฏุงุฏุงุช,
            text="๐ ูุณุชูู ุงูุตูุช",
            font=self.ุฎุท_ุนุฑุจู,
            fg='white',
            bg='#37474f'
        ).pack()
        
        self.ูููุงุณ_ุงูุตูุช = tk.Scale(
            ุฅุทุงุฑ_ุงูุฅุนุฏุงุฏุงุช,
            from_=0,
            to=100,
            orient='horizontal',
            bg='#37474f',
            fg='white',
            highlightthickness=0
        )
        self.ูููุงุณ_ุงูุตูุช.set(self.ุตูุช_ูุณุชูู)
        self.ูููุงุณ_ุงูุตูุช.pack(fill='x', padx=10)

    def ุงูุดุงุก_ููุทูุฉ_ุงููุญุงุฏุซุฉ(self):
        """ุฅูุดุงุก ููุทูุฉ ุงููุญุงุฏุซุฉ"""
        ุฅุทุงุฑ_ุงููุญุงุฏุซุฉ = tk.Frame(self.root, bg='#f5f5f5')
        ุฅุทุงุฑ_ุงููุญุงุฏุซุฉ.pack(side='bottom', fill='x', padx=10, pady=5)
        
        # ุนููุงู ุงููุญุงุฏุซุฉ
        tk.Label(
            ุฅุทุงุฑ_ุงููุญุงุฏุซุฉ,
            text="๐ฌ ูุญุงุฏุซุฉ ูุน ุงูุฏุจุฏูุจ",
            font=self.ุฎุท_ุนููุงู,
            bg='#f5f5f5'
        ).pack(pady=5)
        
        # ููุทูุฉ ุนุฑุถ ุงููุญุงุฏุซุฉ
        ุฅุทุงุฑ_ุงูุนุฑุถ = tk.Frame(ุฅุทุงุฑ_ุงููุญุงุฏุซุฉ, bg='#f5f5f5')
        ุฅุทุงุฑ_ุงูุนุฑุถ.pack(fill='both', expand=True, pady=5)
        
        self.ูุต_ุงููุญุงุฏุซุฉ = tk.Text(
            ุฅุทุงุฑ_ุงูุนุฑุถ,
            height=8,
            width=80,
            font=self.ุฎุท_ุนุฑุจู,
            wrap='word',
            bg='white',
            state='disabled'
        )
        
        ุดุฑูุท_ุงูุชูุฑูุฑ = tk.Scrollbar(ุฅุทุงุฑ_ุงูุนุฑุถ, orient='vertical', command=self.ูุต_ุงููุญุงุฏุซุฉ.yview)
        self.ูุต_ุงููุญุงุฏุซุฉ.configure(yscrollcommand=ุดุฑูุท_ุงูุชูุฑูุฑ.set)
        
        self.ูุต_ุงููุญุงุฏุซุฉ.pack(side='left', fill='both', expand=True, padx=5)
        ุดุฑูุท_ุงูุชูุฑูุฑ.pack(side='right', fill='y')
        
        # ุฅุทุงุฑ ุงูุฅุฏุฎุงู
        ุฅุทุงุฑ_ุงูุฅุฏุฎุงู = tk.Frame(ุฅุทุงุฑ_ุงููุญุงุฏุซุฉ, bg='#f5f5f5')
        ุฅุทุงุฑ_ุงูุฅุฏุฎุงู.pack(fill='x', pady=5)
        
        tk.Label(
            ุฅุทุงุฑ_ุงูุฅุฏุฎุงู,
            text="โ๏ธ ุงูุชุจ ุฑุณุงูุชู:",
            font=self.ุฎุท_ุนุฑุจู,
            bg='#f5f5f5'
        ).pack(anchor='w')
        
        ุฅุทุงุฑ_ุงูุฅุฑุณุงู = tk.Frame(ุฅุทุงุฑ_ุงูุฅุฏุฎุงู, bg='#f5f5f5')
        ุฅุทุงุฑ_ุงูุฅุฑุณุงู.pack(fill='x', pady=5)
        
        self.ุญูู_ุงูุฑุณุงูุฉ = tk.Entry(
            ุฅุทุงุฑ_ุงูุฅุฑุณุงู,
            font=self.ุฎุท_ุนุฑุจู,
            width=60
        )
        self.ุญูู_ุงูุฑุณุงูุฉ.pack(side='left', fill='x', expand=True, padx=(0, 10))
        self.ุญูู_ุงูุฑุณุงูุฉ.bind('<Return>', self.ุงุฑุณุงู_ุฑุณุงูุฉ_enter)
        
        self.ุฒุฑ_ุงูุฅุฑุณุงู = tk.Button(
            ุฅุทุงุฑ_ุงูุฅุฑุณุงู,
            text="๐ค ุฅุฑุณุงู",
            font=self.ุฎุท_ุนุฑุจู,
            bg='#4caf50',
            fg='white',
            command=self.ุงุฑุณุงู_ุฑุณุงูุฉ,
            state='disabled'
        )
        self.ุฒุฑ_ุงูุฅุฑุณุงู.pack(side='right')

    def ุจุฏุก_ุงูุฑุณูู_ุงููุชุญุฑูุฉ(self):
        """ุจุฏุก ุญููุฉ ุงูุฑุณูู ุงููุชุญุฑูุฉ"""
        self.ุชุญุฏูุซ_ุงููุคุดุฑุงุช()
        self.ุชุญุฑูู_ุงูุฏุจุฏูุจ()

    def ุชุญุฑูู_ุงูุฏุจุฏูุจ(self):
        """ุชุญุฑูู ุงูุฏุจุฏูุจ ุญุณุจ ุงูุญุงูุฉ"""
        if self.ุญุงูุฉ_ุงูุฏุจุฏูุจ == "ูุณุชูุน" and self.ุญุงูุฉ_ุงูุทุงูุฉ:
            # ูููุถ ุงูุฃุฐููู
            current_time = time.time()
            if int(current_time * 2) % 2:
                self.led_ููู = "ุฃุตูุฑ"
            else:
                self.led_ููู = "ุฃุฒุฑู"
            self.ุฑุณู_ูุฌู_ุงูุฏุจุฏูุจ()
        
        # ุฅุนุงุฏุฉ ุฌุฏููุฉ ุงูุชุญุฑูู
        self.root.after(500, self.ุชุญุฑูู_ุงูุฏุจุฏูุจ)

    def ุชุญุฏูุซ_ุงููุคุดุฑุงุช(self):
        """ุชุญุฏูุซ ูุคุดุฑุงุช ุงูุญุงูุฉ"""
        # ุชุญุฏูุซ ุงูุจุทุงุฑูุฉ (ุชูู ุจุจุทุก)
        if self.ุญุงูุฉ_ุงูุทุงูุฉ:
            self.ูุณุชูู_ุงูุจุทุงุฑูุฉ = max(0, self.ูุณุชูู_ุงูุจุทุงุฑูุฉ - 0.1)
        
        # ุชุญุฏูุซ ุงูุชุณููุงุช
        self.ุชุณููุฉ_ุงูุจุทุงุฑูุฉ.config(text=f"๐ ุงูุจุทุงุฑูุฉ: {int(self.ูุณุชูู_ุงูุจุทุงุฑูุฉ)}%")
        self.ุชุณููุฉ_wifi.config(text=f"๐ถ WiFi: {self.ููุฉ_WiFi} dBm")
        self.ุชุณููุฉ_led.config(text=f"๐ก LED: {self.led_ููู}")
        
        # ุฅุนุงุฏุฉ ุฌุฏููุฉ ุงูุชุญุฏูุซ
        self.root.after(5000, self.ุชุญุฏูุซ_ุงููุคุดุฑุงุช)

    def ุฅุถุงูุฉ_ุฑุณุงูุฉ_ูุญุงุฏุซุฉ(self, ุงููุฑุณู: str, ุงูุฑุณุงูุฉ: str, ุงูููู: str = 'black'):
        """ุฅุถุงูุฉ ุฑุณุงูุฉ ูููุญุงุฏุซุฉ"""
        self.ูุต_ุงููุญุงุฏุซุฉ.config(state='normal')
        
        ุงูููุช = datetime.now().strftime("%H:%M:%S")
        
        if ุงููุฑุณู == "ุทูู":
            ุงูุจุงุฏุฆุฉ = "๐ถ ุฃูุช"
            ููู_ุงููุฑุณู = '#1976d2'
        elif ุงููุฑุณู == "ุฏุจุฏูุจ":
            ุงูุจุงุฏุฆุฉ = "๐งธ ุงูุฏุจุฏูุจ"
            ููู_ุงููุฑุณู = '#d32f2f'
        else:
            ุงูุจุงุฏุฆุฉ = "โน๏ธ ุงููุธุงู"
            ููู_ุงููุฑุณู = '#388e3c'
        
        self.ูุต_ุงููุญุงุฏุซุฉ.insert(tk.END, f"[{ุงูููุช}] {ุงูุจุงุฏุฆุฉ}: ", 'sender')
        self.ูุต_ุงููุญุงุฏุซุฉ.insert(tk.END, f"{ุงูุฑุณุงูุฉ}\n\n", 'message')
        
        # ุชูุณูู ุงููุต
        self.ูุต_ุงููุญุงุฏุซุฉ.tag_config('sender', foreground=ููู_ุงููุฑุณู, font=(self.ุฎุท_ุนุฑุจู['family'], self.ุฎุท_ุนุฑุจู['size'], 'bold'))
        self.ูุต_ุงููุญุงุฏุซุฉ.tag_config('message', foreground='black', font=self.ุฎุท_ุนุฑุจู)
        
        self.ูุต_ุงููุญุงุฏุซุฉ.config(state='disabled')
        self.ูุต_ุงููุญุงุฏุซุฉ.see(tk.END)

    def ุชุจุฏูู_ุงูุทุงูุฉ(self):
        """ุชุดุบูู/ุฅุทูุงุก ุงูุฏุจุฏูุจ"""
        if not self.ุญุงูุฉ_ุงูุทุงูุฉ:
            self.ุชุดุบูู_ุงูุฏุจุฏูุจ()
        else:
            self.ุฅุทูุงุก_ุงูุฏุจุฏูุจ()

    def ุชุดุบูู_ุงูุฏุจุฏูุจ(self):
        """ุชุดุบูู ุงูุฏุจุฏูุจ"""
        self.ุญุงูุฉ_ุงูุทุงูุฉ = True
        self.ุญุงูุฉ_ุงูุฏุจุฏูุจ = "ูุณุชูุน"
        
        # ุชุญุฏูุซ ุงููุงุฌูุฉ
        self.ุฒุฑ_ุงูุทุงูุฉ.config(text="๐ด ุฅุทูุงุก ุงูุฏุจุฏูุจ", bg='#f44336')
        self.ุฒุฑ_ุงูุงุชุตุงู.config(state='normal')
        self.ุฒุฑ_ุงูููุณ.config(state='normal')
        self.ุชุณููุฉ_ุงูุญุงูุฉ.config(text="๐ ุงูุฏุจุฏูุจ ูุณุชููุธ ููุณุชุนุฏ!", fg='#1976d2')
        
        self.ุฑุณู_ูุฌู_ุงูุฏุจุฏูุจ()
        
        self.ุฅุถุงูุฉ_ุฑุณุงูุฉ_ูุญุงุฏุซุฉ("ุงููุธุงู", "๐ ุชู ุชุดุบูู ุงูุฏุจุฏูุจ ุจูุฌุงุญ!")
        self.ุฅุถุงูุฉ_ุฑุณุงูุฉ_ูุญุงุฏุซุฉ("ุฏุจุฏูุจ", "ูุฑุญุจุงู! ุฃูุง ูุณุชููุธ ุงูุขู. ุงุชุตู ุจู ุจุงูุณุญุงุจุฉ ููุชุญุฏุซ!")

    def ุฅุทูุงุก_ุงูุฏุจุฏูุจ(self):
        """ุฅุทูุงุก ุงูุฏุจุฏูุจ"""
        self.ุญุงูุฉ_ุงูุทุงูุฉ = False
        self.ุญุงูุฉ_ุงูุงุชุตุงู = False
        self.ุญุงูุฉ_ุงูุฏุจุฏูุจ = "ูุงุฆู"
        
        # ุชุญุฏูุซ ุงููุงุฌูุฉ
        self.ุฒุฑ_ุงูุทุงูุฉ.config(text="๐ ุชุดุบูู ุงูุฏุจุฏูุจ", bg='#4caf50')
        self.ุฒุฑ_ุงูุงุชุตุงู.config(state='disabled')
        self.ุฒุฑ_ุงูููุณ.config(state='disabled')
        self.ุฒุฑ_ุงูุฅุฑุณุงู.config(state='disabled')
        self.ุชุณููุฉ_ุงูุญุงูุฉ.config(text="๐ด ุงูุฏุจุฏูุจ ูุงุฆู", fg='#757575')
        
        self.ุฑุณู_ูุฌู_ุงูุฏุจุฏูุจ()
        
        self.ุฅุถุงูุฉ_ุฑุณุงูุฉ_ูุญุงุฏุซุฉ("ุงููุธุงู", "๐ด ุชู ุฅุทูุงุก ุงูุฏุจุฏูุจ. ุชุตุจุญ ุนูู ุฎูุฑ!")

    def ุงุฎุชุจุงุฑ_ุงูุงุชุตุงู(self):
        """ุงุฎุชุจุงุฑ ุงูุงุชุตุงู ุจุงูุฎุงุฏู"""
        self.ุชุณููุฉ_ุงูุญุงูุฉ.config(text="๐ ุฌุงุฑู ุงูุงุชุตุงู ุจุงูุณุญุงุจุฉ...")
        self.ุญุงูุฉ_ุงูุฏุจุฏูุจ = "ูููุฑ"
        self.ุฑุณู_ูุฌู_ุงูุฏุจุฏูุจ()
        
        thread = threading.Thread(target=self.ุชุดุบูู_ุงุฎุชุจุงุฑ_ุงูุงุชุตุงู, daemon=True)
        thread.start()

    def ุชุดุบูู_ุงุฎุชุจุงุฑ_ุงูุงุชุตุงู(self):
        """ุชุดุบูู ุงุฎุชุจุงุฑ ุงูุงุชุตุงู"""
        try:
            async def ุงุฎุชุจุงุฑ():
                response = await self.client.get(f"{self.server_url}/esp32/connect")
                return response.status_code == 200, response.json() if response.status_code == 200 else None
            
            loop = asyncio.new_event_loop()
            asyncio.set_event_loop(loop)
            ูุฌุญ, ุงูุจูุงูุงุช = loop.run_until_complete(ุงุฎุชุจุงุฑ())
            loop.close()
            
            self.root.after(0, self.ูุชูุฌุฉ_ุงูุงุชุตุงู, ูุฌุญ, ุงูุจูุงูุงุช)
            
        except Exception as e:
            self.root.after(0, self.ูุชูุฌุฉ_ุงูุงุชุตุงู, False, str(e))

    def ูุชูุฌุฉ_ุงูุงุชุตุงู(self, ูุฌุญ: bool, ุงูุจูุงูุงุช: Any):
        """ูุชูุฌุฉ ุงุฎุชุจุงุฑ ุงูุงุชุตุงู"""
        if ูุฌุญ:
            self.ุญุงูุฉ_ุงูุงุชุตุงู = True
            self.ุญุงูุฉ_ุงูุฏุจุฏูุจ = "ุณุนูุฏ"
            self.ุชุณููุฉ_ุงูุญุงูุฉ.config(text="โ ูุชุตู ุจุงูุฐูุงุก ุงูุงุตุทูุงุนู!", fg='#2e7d32')
            self.ุฒุฑ_ุงูุฅุฑุณุงู.config(state='normal')
            
            self.ุฅุถุงูุฉ_ุฑุณุงูุฉ_ูุญุงุฏุซุฉ("ุงููุธุงู", "โ ุชู ุงูุงุชุตุงู ุจุงูุณุญุงุจุฉ ุจูุฌุงุญ!")
            self.ุฅุถุงูุฉ_ุฑุณุงูุฉ_ูุญุงุฏุซุฉ("ุฏุจุฏูุจ", "ุฑุงุฆุน! ุงูุขู ูููููู ุฃู ุฃูููู ูุฃุฌูุจ ุจุฐูุงุก. ุฌุฑุจ ุฃู ุชููููู!")
        else:
            self.ุญุงูุฉ_ุงูุฏุจุฏูุจ = "ูุณุชูุน"
            self.ุชุณููุฉ_ุงูุญุงูุฉ.config(text="โ ูุดู ุงูุงุชุตุงู", fg='#d32f2f')
            
            self.ุฅุถุงูุฉ_ุฑุณุงูุฉ_ูุญุงุฏุซุฉ("ุงููุธุงู", f"โ ูุดู ุงูุงุชุตุงู: {ุงูุจูุงูุงุช}")
            self.ุฅุถุงูุฉ_ุฑุณุงูุฉ_ูุญุงุฏุซุฉ("ุฏุจุฏูุจ", "ูุง ุฃุณุชุทูุน ุงูุงุชุตุงู ุจุงูุณุญุงุจุฉุ ููู ูููููู ูุญุงุฏุซุชู ุจุฑุฏูุฏ ุจุณูุทุฉ!")
        
        self.ุฑุณู_ูุฌู_ุงูุฏุจุฏูุจ()

    def ููุณ_ุงูุฏุจุฏูุจ(self):
        """ูุญุงูุงุฉ ููุณ ุงูุฏุจุฏูุจ"""
        if not self.ุญุงูุฉ_ุงูุทุงูุฉ:
            return
        
        self.ุญุงูุฉ_ุงูุฏุจุฏูุจ = "ุณุนูุฏ"
        self.ุฑุณู_ูุฌู_ุงูุฏุจุฏูุจ()
        
        ุฑุฏูุฏ_ุงูููุณ = [
            "ูููู! ูุฐุง ูุฏุบุฏุบูู! ๐",
            "ุฃุญุจ ุนูุฏูุง ุชููุณูู! ๐ฅฐ",
            "ูุฑุญุจุงู ุตุฏููู! ๐",
            "ุฃูุช ูุทูู ุฌุฏุงู! ๐",
            "ูู ุชุฑูุฏ ุฃู ููุนุจุ ๐ฎ"
        ]
        
        import random
        ุฑุฏ = random.choice(ุฑุฏูุฏ_ุงูููุณ)
        self.ุฅุถุงูุฉ_ุฑุณุงูุฉ_ูุญุงุฏุซุฉ("ุฏุจุฏูุจ", ุฑุฏ)
        
        # ุงูุนูุฏุฉ ููุญุงูุฉ ุงูุนุงุฏูุฉ ุจุนุฏ 3 ุซูุงูู
        self.root.after(3000, self.ุงูุนูุฏุฉ_ููุงุณุชูุงุน)

    def ุงูุนูุฏุฉ_ููุงุณุชูุงุน(self):
        """ุงูุนูุฏุฉ ูุญุงูุฉ ุงูุงุณุชูุงุน"""
        if self.ุญุงูุฉ_ุงูุทุงูุฉ:
            self.ุญุงูุฉ_ุงูุฏุจุฏูุจ = "ูุณุชูุน"
            self.ุชุณููุฉ_ุงูุญุงูุฉ.config(text="๐ ุงูุฏุจุฏูุจ ูุณุชูุน...")
            self.ุฑุณู_ูุฌู_ุงูุฏุจุฏูุจ()

    def ุงุฑุณุงู_ุฑุณุงูุฉ_enter(self, event):
        """ุฅุฑุณุงู ุงูุฑุณุงูุฉ ุจุถุบุท Enter"""
        self.ุงุฑุณุงู_ุฑุณุงูุฉ()

    def ุงุฑุณุงู_ุฑุณุงูุฉ(self):
        """ุฅุฑุณุงู ุฑุณุงูุฉ ููุฏุจุฏูุจ"""
        ุงูุฑุณุงูุฉ = self.ุญูู_ุงูุฑุณุงูุฉ.get().strip()
        if not ุงูุฑุณุงูุฉ:
            return
        
        self.ุญูู_ุงูุฑุณุงูุฉ.delete(0, tk.END)
        
        # ุฅุถุงูุฉ ุฑุณุงูุฉ ุงูุทูู
        self.ุฅุถุงูุฉ_ุฑุณุงูุฉ_ูุญุงุฏุซุฉ("ุทูู", ุงูุฑุณุงูุฉ)
        
        # ุชุญุฏูุซ ุญุงูุฉ ุงูุฏุจุฏูุจ
        self.ุญุงูุฉ_ุงูุฏุจุฏูุจ = "ูููุฑ"
        self.ุชุณููุฉ_ุงูุญุงูุฉ.config(text="๐ง ุงูุฏุจุฏูุจ ูููุฑ...")
        self.ุฑุณู_ูุฌู_ุงูุฏุจุฏูุจ()
        
        # ุฅุฑุณุงู ููุฎุงุฏู
        thread = threading.Thread(target=self.ุงุฑุณุงู_ููุฎุงุฏู, args=(ุงูุฑุณุงูุฉ,), daemon=True)
        thread.start()

    def ุงุฑุณุงู_ููุฎุงุฏู(self, ุงูุฑุณุงูุฉ: str):
        """ุฅุฑุณุงู ุงูุฑุณุงูุฉ ููุฎุงุฏู"""
        try:
            async def ุงุฑุณุงู():
                response = await self.client.post(
                    f"{self.server_url}/api/audio/upload",
                    params={
                        "device_id": self.device_id,
                        "text_message": ุงูุฑุณุงูุฉ
                    }
                )
                return response.status_code == 200, response.json() if response.status_code == 200 else response.text
            
            loop = asyncio.new_event_loop()
            asyncio.set_event_loop(loop)
            ูุฌุญ, ุงูุจูุงูุงุช = loop.run_until_complete(ุงุฑุณุงู())
            loop.close()
            
            self.root.after(0, self.ุงุณุชุฌุงุจุฉ_ุงูุฎุงุฏู, ูุฌุญ, ุงูุจูุงูุงุช)
            
        except Exception as e:
            self.root.after(0, self.ุงุณุชุฌุงุจุฉ_ุงูุฎุงุฏู, False, str(e))

    def ุงุณุชุฌุงุจุฉ_ุงูุฎุงุฏู(self, ูุฌุญ: bool, ุงูุจูุงูุงุช: Any):
        """ุงุณุชุฌุงุจุฉ ุงูุฎุงุฏู"""
        if ูุฌุญ and isinstance(ุงูุจูุงูุงุช, dict):
            ุงุณุชุฌุงุจุฉ_ุงูุฐูุงุก = ุงูุจูุงูุงุช.get('ai_response', {})
            ูุต_ุงูุฐูุงุก = ุงุณุชุฌุงุจุฉ_ุงูุฐูุงุก.get('text', 'ุขุณูุ ูู ุฃุณุชุทุน ูููู.')
            
            # ุชุญุฏูุซ ุญุงูุฉ ุงูุฏุจุฏูุจ ููุชุญุฏุซ
            self.ุญุงูุฉ_ุงูุฏุจุฏูุจ = "ูุชุญุฏุซ"
            self.ุชุณููุฉ_ุงูุญุงูุฉ.config(text="๐ฃ๏ธ ุงูุฏุจุฏูุจ ูุชุญุฏุซ...")
            self.ุฑุณู_ูุฌู_ุงูุฏุจุฏูุจ()
            
            # ุฅุถุงูุฉ ุฑุฏ ุงูุฏุจุฏูุจ
            self.ุฅุถุงูุฉ_ุฑุณุงูุฉ_ูุญุงุฏุซุฉ("ุฏุจุฏูุจ", ูุต_ุงูุฐูุงุก)
            
            # ุงูุนูุฏุฉ ููุงุณุชูุงุน ุจุนุฏ 3 ุซูุงูู
            self.root.after(3000, self.ุงูุนูุฏุฉ_ููุงุณุชูุงุน)
            
        else:
            self.ุญุงูุฉ_ุงูุฏุจุฏูุจ = "ูุณุชูุน"
            self.ุชุณููุฉ_ุงูุญุงูุฉ.config(text="โ ุฎุทุฃ ูู ุงูุงุณุชุฌุงุจุฉ")
            self.ุฑุณู_ูุฌู_ุงูุฏุจุฏูุจ()
            
            self.ุฅุถุงูุฉ_ุฑุณุงูุฉ_ูุญุงุฏุซุฉ("ุงููุธุงู", f"โ ุฎุทุฃ: {ุงูุจูุงูุงุช}")
            self.ุฅุถุงูุฉ_ุฑุณุงูุฉ_ูุญุงุฏุซุฉ("ุฏุจุฏูุจ", "ุขุณูุ ูุงุฌูุช ูุดููุฉ ูู ูููู. ุญุงูู ูุฑุฉ ุฃุฎุฑู!")

    async def ุชูุธูู_ุงูููุงุฑุฏ(self):
        """ุชูุธูู ุงูููุงุฑุฏ"""
        await self.client.aclose()

    def ุนูุฏ_ุงูุฅุบูุงู(self):
        """ุนูุฏ ุฅุบูุงู ุงููุงูุฐุฉ"""
        asyncio.run(self.ุชูุธูู_ุงูููุงุฑุฏ())
        self.root.destroy()

    def ุชุดุบูู(self):
        """ุชุดุบูู ุงููุญุงูู"""
        self.root.protocol("WM_DELETE_WINDOW", self.ุนูุฏ_ุงูุฅุบูุงู)
        
        # ุฑุณุงุฆู ุงูุชุฑุญูุจ
        self.ุฅุถุงูุฉ_ุฑุณุงูุฉ_ูุญุงุฏุซุฉ("ุงููุธุงู", "๐งธ ุฃููุงู ุจู ูู ูุญุงูู ุงูุฏุจุฏูุจ ุงูุฐูู!")
        self.ุฅุถุงูุฉ_ุฑุณุงูุฉ_ูุญุงุฏุซุฉ("ุงููุธุงู", "1. ุงุถุบุท 'ุชุดุบูู ุงูุฏุจุฏูุจ' ููุจุฏุก")
        self.ุฅุถุงูุฉ_ุฑุณุงูุฉ_ูุญุงุฏุซุฉ("ุงููุธุงู", "2. ุงุถุบุท 'ุงุชุตุงู ุงูุณุญุงุจุฉ' ููุงุชุตุงู ุจุงูุฐูุงุก ุงูุงุตุทูุงุนู")
        self.ุฅุถุงูุฉ_ุฑุณุงูุฉ_ูุญุงุฏุซุฉ("ุงููุธุงู", "3. ุงุจุฏุฃ ุงููุญุงุฏุซุฉ ูุน ุฏุจุฏูุจู!")
        
        self.root.mainloop()


if __name__ == "__main__":
    print("๐ ุจุฏุก ุชุดุบูู ูุญุงูู ุงูุฏุจุฏูุจ ุงูุฐูู ุงูุงุญุชุฑุงูู...")
    
    # ุชุญูู ูู ุงูููุชุจุงุช ุงููุทููุจุฉ
    try:
        import httpx
    except ImportError:
        print("โ๏ธ ุชุซุจูุช httpx...")
        import subprocess
        subprocess.check_call(["pip", "install", "httpx"])
        import httpx
    
    ูุญุงูู = ูุญุงูู_ุงูุฏุจุฏูุจ_ุงูุฐูู()
    ูุญุงูู.ุชุดุบูู() 