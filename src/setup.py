# [AI-Generated by Amazon Q]: ุชู ุฅุถุงูุฉ ูุฐุง ุงูููุฏ ุชููุงุฆูุงู ููู ุฏููู ุงููุดุฑูุน.
#!/usr/bin/env python3
"""
ุณูุฑูุจุช ุฅุนุฏุงุฏ ูุชุดุบูู ูุดุฑูุน AI Teddy Bear
"""
import structlog
logger = structlog.get_logger(__name__)


import os
import sys
import subprocess
from pathlib import Path

def create_directories():
    """ุฅูุดุงุก ุงููุฌูุฏุงุช ุงููุทููุจุฉ"""
    directories = [
        "data",
        "uploads/audio",
        "uploads/temp", 
        "outputs/stories",
        "outputs/responses",
        "outputs/processed",
        "static/css",
        "static/js",
        "static/images",
        "logs"
    ]
    
    for directory in directories:
        Path(directory).mkdir(parents=True, exist_ok=True)
        print(f"โ ุชู ุฅูุดุงุก ูุฌูุฏ: {directory}")

def install_requirements():
    """ุชุซุจูุช ุงููุชุทูุจุงุช"""
    print("๐ฆ ุชุซุจูุช ุงููุชุทูุจุงุช...")
    try:
        subprocess.check_call([sys.executable, "-m", "pip", "install", "-r", "requirements.txt"])
        print("โ ุชู ุชุซุจูุช ุฌููุน ุงููุชุทูุจุงุช ุจูุฌุงุญ")
    except Exception as e:
    logger.error(f"Error: {e}")"โ ูุดู ูู ุชุซุจูุช ุงููุชุทูุจุงุช")
        return False
    return True

def create_env_file():
    """ุฅูุดุงุก ููู ุงูุจูุฆุฉ"""
    env_content = """# [AI-Generated by Amazon Q]: ููู ูุชุบูุฑุงุช ุงูุจูุฆุฉ

# ููุงุชูุญ API (ูุฌุจ ุชุนุจุฆุชูุง)
OPENAI_API_KEY=your_openai_key_here
HUME_API_KEY=your_hume_key_here
ELEVENLABS_API_KEY=your_elevenlabs_key_here
DEEPGRAM_API_KEY=your_deepgram_key_here

# ูุงุนุฏุฉ ุงูุจูุงูุงุช
DATABASE_URL=sqlite:///data/teddy_bear.db

# ุฅุนุฏุงุฏุงุช ุงูุจุฑูุฏ ุงูุฅููุชุฑููู
SMTP_SERVER=smtp.gmail.com
SMTP_PORT=587
EMAIL_USERNAME=your_email@gmail.com
EMAIL_PASSWORD=your_app_password

# ุฅุนุฏุงุฏุงุช ุงูุฃูุงู
MAX_FILE_SIZE=10485760
RATE_LIMIT_PER_MINUTE=60

# ุฅุนุฏุงุฏุงุช ุงูุชุทุจูู
DEBUG=False
HOST=0.0.0.0
PORT=8000
"""
    
    if not Path(".env").exists():
        with open(".env", "w", encoding="utf-8") as f:
            f.write(env_content)
        print("โ ุชู ุฅูุดุงุก ููู .env")
        print("โ๏ธ  ูุฑุฌู ุชุนุจุฆุฉ ููุงุชูุญ API ูู ููู .env")
    else:
        print("โ ููู .env ููุฌูุฏ ุจุงููุนู")

def initialize_database():
    """ุชููุฆุฉ ูุงุนุฏุฉ ุงูุจูุงูุงุช"""
    print("๐๏ธ  ุชููุฆุฉ ูุงุนุฏุฉ ุงูุจูุงูุงุช...")
    try:
        from src.data.database import Database
        db = Database()
        print("โ ุชู ุชููุฆุฉ ูุงุนุฏุฉ ุงูุจูุงูุงุช ุจูุฌุงุญ")
    except Exception as e:
    logger.error(f"Error: {e}")f"โ ูุดู ูู ุชููุฆุฉ ูุงุนุฏุฉ ุงูุจูุงูุงุช: {e}")

def run_tests():
    """ุชุดุบูู ุงูุงุฎุชุจุงุฑุงุช"""
    print("๐งช ุชุดุบูู ุงูุงุฎุชุจุงุฑุงุช...")
    try:
        subprocess.check_call([sys.executable, "-m", "pytest", "tests/", "-v"])
        print("โ ุฌููุน ุงูุงุฎุชุจุงุฑุงุช ูุฌุญุช")
    except Exception as e:
    logger.error(f"Error: {e}")"โ๏ธ  ุจุนุถ ุงูุงุฎุชุจุงุฑุงุช ูุดูุช")
    except Exception as e:
    logger.error(f"Error: {e}")"โน๏ธ  ูุง ุชูุฌุฏ ุงุฎุชุจุงุฑุงุช ููุชุดุบูู")

def main():
    """ุงูุฏุงูุฉ ุงูุฑุฆูุณูุฉ ููุฅุนุฏุงุฏ"""
    print("๐ ุจุฏุก ุฅุนุฏุงุฏ ูุดุฑูุน AI Teddy Bear")
    print("=" * 50)
    
    # ุฅูุดุงุก ุงููุฌูุฏุงุช
    create_directories()
    
    # ุชุซุจูุช ุงููุชุทูุจุงุช
    if not install_requirements():
        return
    
    # ุฅูุดุงุก ููู ุงูุจูุฆุฉ
    create_env_file()
    
    # ุชููุฆุฉ ูุงุนุฏุฉ ุงูุจูุงูุงุช
    initialize_database()
    
    # ุชุดุบูู ุงูุงุฎุชุจุงุฑุงุช
    run_tests()
    
    print("\n" + "=" * 50)
    print("โ ุชู ุฅุนุฏุงุฏ ุงููุดุฑูุน ุจูุฌุงุญ!")
    print("\n๐ ุฎุทูุงุช ุงูุชุดุบูู:")
    print("1. ุชุนุจุฆุฉ ููุงุชูุญ API ูู ููู .env")
    print("2. ุชุดุบูู ุงูุฃูุฑ: python main.py")
    print("3. ูุชุญ ุงููุชุตูุญ ุนูู: http://localhost:8000")
    print("\n๐ง ูููุณุงุนุฏุฉ:")
    print("- ููุญุฉ ุงูุฃูู: http://localhost:8000")
    print("- API ุงูุชูุงุนู: http://localhost:8000/interact")
    print("- WebSocket: ws://localhost:8000/ws/{child_id}")

if __name__ == "__main__":
    main()