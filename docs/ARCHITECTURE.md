# [AI-Generated by Amazon Q]: تم إضافة هذا الكود تلقائياً وفق دليل المشروع.

# بنية المشروع - AI Teddy Bear

## نظرة عامة على البنية

### الطبقات الرئيسية
```
┌─────────────────────────────────────┐
│           API Layer                 │  ← واجهات المستخدم
├─────────────────────────────────────┤
│       Application Layer             │  ← منطق التطبيق
├─────────────────────────────────────┤
│         Domain Layer                │  ← منطق الأعمال
├─────────────────────────────────────┤
│      Infrastructure Layer           │  ← الخدمات الخارجية
└─────────────────────────────────────┘
```

## الخدمات الأساسية

### 1. خدمة تحليل المشاعر (EmotionAnalyzer)
- **الملف**: `src/domain/emotion_analyzer.py`
- **الوظيفة**: تحليل مشاعر الطفل من الصوت
- **التبعيات**: Hume AI API
- **الاستخدام**: `emotion_analyzer.analyze_audio_emotion(audio_file)`

### 2. محرك الألعاب (VoiceGameEngine)
- **الملف**: `src/domain/games/voice_games_engine.py`
- **الوظيفة**: إدارة الألعاب التفاعلية
- **التبعيات**: OpenAI API
- **الاستخدام**: `game_engine.start_game(game_type, child_name, age)`

### 3. مولد القصص (PersonalizedStoryGenerator)
- **الملف**: `src/domain/story_generator.py`
- **الوظيفة**: توليد قصص مخصصة
- **التبعيات**: OpenAI API
- **الاستخدام**: `story_generator.generate_personalized_story(...)`

### 4. محرك الأصوات المتعددة (MultiVoiceTTS)
- **الملف**: `src/audio/multi_voice_tts.py`
- **الوظيفة**: تحويل النص لصوت متعدد الشخصيات
- **التبعيات**: ElevenLabs API
- **الاستخدام**: `voice_engine.generate_multi_character_audio(...)`

### 5. كاشف اضطرابات النطق (SpeechDisorderDetector)
- **الملف**: `src/audio/speech_disorder_detector.py`
- **الوظيفة**: كشف مبكر لمشاكل النطق
- **التبعيات**: Librosa, NumPy
- **الاستخدام**: `speech_detector.analyze_speech_patterns(audio_file)`

## مسارات الاستيراد الموحدة

### الخدمات الأساسية
```python
from src.domain.emotion_analyzer import EmotionAnalyzer
from src.domain.games.voice_games_engine import VoiceGameEngine
from src.domain.story_generator import PersonalizedStoryGenerator
from src.audio.multi_voice_tts import MultiVoiceTTS
from src.audio.speech_disorder_detector import SpeechDisorderDetector
```

### الخدمات التطبيقية
```python
from src.application.main_service import AITeddyBearService
from src.application.health_monitoring import HealthMonitoringService
from src.application.story_service import StoryService
```

### البيانات والتحليلات
```python
from src.data.database import Database
from src.domain.analytics import ChildAnalytics
```

### الأمان والبنية التحتية
```python
from src.infrastructure.security import SecurityManager
from src.infrastructure.file_manager import FileManager
from src.infrastructure.external_services import ExternalAPIManager
```

## تدفق البيانات

### تفاعل صوتي نموذجي
```
Audio Input → Speech Recognition → Emotion Analysis → Response Generation → Voice Synthesis → Audio Output
     ↓              ↓                    ↓                    ↓                  ↓
Database ← Speech Analysis ← Context Update ← Content Selection ← Voice Processing
```

### معالجة البيانات
```
User Input → Validation → Processing → Storage → Analytics → Dashboard
```

## إدارة الحالة

### جلسات المستخدم
- **التخزين**: في الذاكرة (للجلسات النشطة)
- **المدة**: حتى إنهاء الجلسة
- **البيانات**: سياق المحادثة، تاريخ المشاعر، حالة اللعبة

### البيانات الدائمة
- **قاعدة البيانات**: SQLite
- **الجداول**: children, interactions, emotions, games, speech_analysis
- **النسخ الاحتياطية**: تلقائية يومياً

## الأمان والحماية

### طبقات الحماية
1. **التحقق من المدخلات**: في طبقة API
2. **التشفير**: للبيانات الحساسة
3. **التحكم في الوصول**: حسب الأدوار
4. **مراقبة الأنشطة**: تسجيل شامل

### حماية البيانات
- تشفير البيانات الحساسة
- إخفاء هوية التقارير
- حذف تلقائي للبيانات القديمة
- امتثال لقوانين حماية الأطفال

## التكامل مع الخدمات الخارجية

### APIs المستخدمة
- **OpenAI**: للمحادثات والقصص
- **Hume AI**: لتحليل المشاعر
- **ElevenLabs**: لتحويل النص لصوت
- **SMTP**: لإرسال التنبيهات

### إدارة المفاتيح
- تخزين آمن في متغيرات البيئة
- عدم تضمين المفاتيح في الكود
- تدوير دوري للمفاتيح

## الأداء والتحسين

### استراتيجيات التحسين
- **التخزين المؤقت**: للاستجابات المتكررة
- **المعالجة غير المتزامنة**: للعمليات الطويلة
- **ضغط البيانات**: للملفات الصوتية
- **فهرسة قاعدة البيانات**: للاستعلامات السريعة

### مراقبة الأداء
- زمن الاستجابة
- استهلاك الذاكرة
- معدل الأخطاء
- رضا المستخدمين

---

هذا التوثيق يوضح البنية الشاملة للمشروع ويساعد المطورين على فهم كيفية تفاعل المكونات المختلفة.