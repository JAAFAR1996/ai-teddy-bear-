# Alertmanager Configuration - Emergency Security Notifications
# AI Teddy Bear Project - Critical Alert Management

global:
  smtp_smarthost: 'localhost:587'
  smtp_from: 'security-alerts@teddybear.ai'
  smtp_auth_username: 'security@teddybear.ai'
  smtp_auth_password: 'secure_email_password'
  slack_api_url: 'https://hooks.slack.com/services/YOUR/SLACK/WEBHOOK'

# ØªÙˆØ¬ÙŠÙ‡ Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡Ø§Øª Ø­Ø³Ø¨ Ø§Ù„Ø®Ø·ÙˆØ±Ø©
route:
  group_by: ['severity', 'category', 'alertname']
  group_wait: 5s        # Ø§Ù†ØªØ¸Ø§Ø± Ù‚ØµÙŠØ± Ù„ØªØ¬Ù…ÙŠØ¹ Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡Ø§Øª
  group_interval: 30s   # ÙØªØ±Ø© ØªØ¬Ù…ÙŠØ¹ Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡Ø§Øª
  repeat_interval: 2m   # Ø¥Ø¹Ø§Ø¯Ø© Ø¥Ø±Ø³Ø§Ù„ Ø³Ø±ÙŠØ¹Ø© Ù„Ù„ØªÙ†Ø¨ÙŠÙ‡Ø§Øª Ø§Ù„Ø­Ø±Ø¬Ø©
  receiver: 'emergency-default'
  
  routes:
    # ØªÙ†Ø¨ÙŠÙ‡Ø§Øª Ø­Ø±Ø¬Ø© - Ø§Ø³ØªØ¬Ø§Ø¨Ø© ÙÙˆØ±ÙŠØ©
    - match:
        severity: critical
      receiver: 'critical-emergency-team'
      group_wait: 0s
      repeat_interval: 1m
      continue: true  # Ø£Ø±Ø³Ù„ Ù„Ù‚Ù†ÙˆØ§Øª Ù…ØªØ¹Ø¯Ø¯Ø©
    
    # ØªÙ†Ø¨ÙŠÙ‡Ø§Øª ØªØ³Ø±ÙŠØ¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª - Ø¥Ø´Ø¹Ø§Ø± Ø®Ø§Øµ
    - match:
        category: data_breach
      receiver: 'data-breach-team'
      group_wait: 0s
      repeat_interval: 30s
      continue: true
    
    # Ù‡Ø¬Ù…Ø§Øª Ø§Ù„Ø£Ù…Ø§Ù† - ÙØ±ÙŠÙ‚ Ø§Ù„Ø¯ÙØ§Ø¹
    - match_re:
        category: (attack|injection_attack|ddos_attack)
      receiver: 'security-defense-team'
      group_wait: 5s
      repeat_interval: 1m
    
    # Ù…Ø´Ø§ÙƒÙ„ Ø§Ù„Ù…ØµØ§Ø¯Ù‚Ø© - ÙØ±ÙŠÙ‚ Ø§Ù„Ù‡ÙˆÙŠØ©
    - match_re:
        category: (brute_force|unauthorized_access)
      receiver: 'identity-team'
      group_wait: 10s
      repeat_interval: 2m
    
    # Ù…Ø´Ø§ÙƒÙ„ Ø§Ù„Ù†Ø¸Ø§Ù… - ÙØ±ÙŠÙ‚ Ø§Ù„Ø¨Ù†ÙŠØ© Ø§Ù„ØªØ­ØªÙŠØ©
    - match_re:
        category: (system_compromise|service_outage)
      receiver: 'infrastructure-team'
      group_wait: 15s
      repeat_interval: 5m

# Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù…ØªÙ„Ù‚ÙŠÙ†
receivers:
  # Ø§Ù„ÙØ±ÙŠÙ‚ Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ Ù„Ù„Ø·ÙˆØ§Ø±Ø¦
  - name: 'emergency-default'
    webhook_configs:
      - url: 'http://emergency-response:8080/webhook/general'
        send_resolved: true
        http_config:
          bearer_token: 'emergency_webhook_token'
        title: 'ğŸš¨ Teddy Bear Security Alert'
        text: |
          {{ range .Alerts }}
          Ø§Ù„Ø®Ø·ÙˆØ±Ø©: {{ .Labels.severity }}
          Ø§Ù„Ù†ÙˆØ¹: {{ .Labels.category }}
          Ø§Ù„ÙˆØµÙ: {{ .Annotations.summary }}
          {{ end }}

  # ÙØ±ÙŠÙ‚ Ø§Ù„Ø·ÙˆØ§Ø±Ø¦ Ø§Ù„Ø­Ø±Ø¬Ø©
  - name: 'critical-emergency-team'
    # Ø¥Ø´Ø¹Ø§Ø±Ø§Øª ÙÙˆØ±ÙŠØ© Ù…ØªØ¹Ø¯Ø¯Ø© Ø§Ù„Ù‚Ù†ÙˆØ§Øª
    webhook_configs:
      - url: 'http://emergency-response:8080/webhook/critical'
        send_resolved: true
        title: 'ğŸ’¥ CRITICAL SECURITY BREACH'
        text: |
          ğŸš¨ ØªÙ†Ø¨ÙŠÙ‡ Ø£Ù…Ù†ÙŠ Ø­Ø±Ø¬ ÙÙˆØ±ÙŠ ğŸš¨
          {{ range .Alerts }}
          Ø§Ù„ØªÙ‡Ø¯ÙŠØ¯: {{ .Annotations.summary }}
          Ø§Ù„ØªØ£Ø«ÙŠØ±: {{ .Annotations.impact }}
          Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©: {{ .Annotations.remediation }}
          {{ end }}
    
    slack_configs:
      - channel: '#security-emergency'
        username: 'TeddySecurityBot'
        icon_emoji: ':rotating_light:'
        title: 'CRITICAL SECURITY ALERT'
        title_link: 'https://grafana.teddybear.ai/d/security-dashboard'
        text: |
          {{ range .Alerts }}
          ğŸ”¥ **{{ .Annotations.summary }}**
          ğŸ“Š **Impact:** {{ .Annotations.impact }}
          ğŸ› ï¸ **Action Required:** {{ .Annotations.remediation }}
          ğŸ“ˆ **Dashboard:** {{ .Annotations.dashboard }}
          {{ end }}
        send_resolved: true
        short_fields: true
    
    email_configs:
      - to: 'security-team@teddybear.ai,cto@teddybear.ai,ceo@teddybear.ai'
        subject: 'ğŸš¨ CRITICAL: {{ .GroupLabels.alertname }}'
        headers:
          Priority: 'urgent'
          X-Priority: '1'
        body: |
          ØªÙ†Ø¨ÙŠÙ‡ Ø£Ù…Ù†ÙŠ Ø­Ø±Ø¬ - ÙŠØªØ·Ù„Ø¨ Ø¥Ø¬Ø±Ø§Ø¡Ù‹ ÙÙˆØ±ÙŠØ§Ù‹
          
          {{ range .Alerts }}
          Ù†ÙˆØ¹ Ø§Ù„ØªÙ‡Ø¯ÙŠØ¯: {{ .Labels.category }}
          Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ø®Ø·ÙˆØ±Ø©: {{ .Labels.severity }}
          
          Ø§Ù„ØªÙØ§ØµÙŠÙ„:
          {{ .Annotations.description }}
          
          Ø§Ù„ØªØ£Ø«ÙŠØ± Ø§Ù„Ù…Ø­ØªÙ…Ù„:
          {{ .Annotations.impact }}
          
          Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø© ÙÙˆØ±Ø§Ù‹:
          {{ .Annotations.remediation }}
          
          Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ©:
          - Ø§Ù„ÙˆÙ‚Øª: {{ .StartsAt }}
          - Ø§Ù„Ù…ØµØ¯Ø±: {{ .Labels.instance }}
          - Ø§Ù„ÙØ¦Ø©: {{ .Labels.category }}
          {{ end }}

  # ÙØ±ÙŠÙ‚ ØªØ³Ø±ÙŠØ¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
  - name: 'data-breach-team'
    webhook_configs:
      - url: 'http://emergency-response:8080/webhook/data-breach'
        send_resolved: true
        title: 'ğŸ’€ DATA BREACH DETECTED'
    
    email_configs:
      - to: 'legal@teddybear.ai,compliance@teddybear.ai,privacy@teddybear.ai'
        subject: 'ğŸš¨ POTENTIAL DATA BREACH: {{ .GroupLabels.alertname }}'
        body: |
          ØªÙ… Ø§ÙƒØªØ´Ø§Ù ØªØ³Ø±ÙŠØ¨ Ù…Ø­ØªÙ…Ù„ Ù„Ù„Ø¨ÙŠØ§Ù†Ø§Øª
          
          {{ range .Alerts }}
          Ù†ÙˆØ¹ Ø§Ù„ØªØ³Ø±ÙŠØ¨: {{ .Labels.category }}
          Ø§Ù„ØªÙØ§ØµÙŠÙ„: {{ .Annotations.description }}
          
          Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª Ø§Ù„Ù‚Ø§Ù†ÙˆÙ†ÙŠØ© Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©:
          1. ØªÙˆØ«ÙŠÙ‚ Ø§Ù„Ø­Ø§Ø¯Ø« ÙÙˆØ±Ø§Ù‹
          2. Ø¥Ø´Ø¹Ø§Ø± Ø§Ù„Ø³Ù„Ø·Ø§Øª Ø§Ù„Ù…Ø®ØªØµØ©
          3. Ø¥Ø¹Ø¯Ø§Ø¯ ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø§Ù…ØªØ«Ø§Ù„
          4. ØªÙ‚ÙŠÙŠÙ… Ø§Ù„ØªØ£Ø«ÙŠØ± Ø¹Ù„Ù‰ Ø§Ù„Ø®ØµÙˆØµÙŠØ©
          {{ end }}

  # ÙØ±ÙŠÙ‚ Ø§Ù„Ø¯ÙØ§Ø¹ Ø§Ù„Ø£Ù…Ù†ÙŠ
  - name: 'security-defense-team'
    webhook_configs:
      - url: 'http://emergency-response:8080/webhook/defense'
        send_resolved: true
    
    slack_configs:
      - channel: '#security-defense'
        title: 'ğŸ›¡ï¸ Security Attack Detected'
        text: |
          {{ range .Alerts }}
          Ù†ÙˆØ¹ Ø§Ù„Ù‡Ø¬ÙˆÙ…: {{ .Labels.category }}
          Ø§Ù„Ù…ØµØ¯Ø±: {{ .Labels.source_ip }}
          Ø§Ù„ØªÙØ§ØµÙŠÙ„: {{ .Annotations.description }}
          {{ end }}

  # ÙØ±ÙŠÙ‚ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù‡ÙˆÙŠØ©
  - name: 'identity-team'
    webhook_configs:
      - url: 'http://emergency-response:8080/webhook/identity'
        send_resolved: true
    
    email_configs:
      - to: 'identity-team@teddybear.ai'
        subject: 'Authentication Security Alert: {{ .GroupLabels.alertname }}'

  # ÙØ±ÙŠÙ‚ Ø§Ù„Ø¨Ù†ÙŠØ© Ø§Ù„ØªØ­ØªÙŠØ©
  - name: 'infrastructure-team'
    webhook_configs:
      - url: 'http://emergency-response:8080/webhook/infrastructure'
        send_resolved: true
    
    slack_configs:
      - channel: '#infrastructure-alerts'
        title: 'ğŸ—ï¸ Infrastructure Security Issue'

# ØªØ«Ø¨ÙŠØ· Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡Ø§Øª Ø§Ù„Ù…ÙƒØ±Ø±Ø©
inhibit_rules:
  # Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ù†Ø¸Ø§Ù… Ù…Ø¹Ø·Ù„ØŒ Ù„Ø§ ØªØ±Ø³Ù„ ØªÙ†Ø¨ÙŠÙ‡Ø§Øª Ø£Ø®Ø±Ù‰ Ù„Ù„Ù†ÙØ³ Ø§Ù„Ù†Ø¸Ø§Ù…
  - source_match:
      alertname: 'TeddyApplicationDown'
    target_match_re:
      alertname: '(HighResponseTime|DatabaseConnectionFailure)'
    equal: ['instance']
  
  # Ø¥Ø°Ø§ ÙƒØ§Ù† Ù‡Ù†Ø§Ùƒ Ù‡Ø¬ÙˆÙ… DDoSØŒ Ù„Ø§ ØªØ±Ø³Ù„ ØªÙ†Ø¨ÙŠÙ‡Ø§Øª Ø§Ù„Ø­Ù…ÙˆÙ„Ø© Ø§Ù„Ø¹Ø§Ù„ÙŠØ©
  - source_match:
      alertname: 'CriticalDDoSAttack'
    target_match_re:
      alertname: '(HighCPUUsage|HighMemoryUsage|HighNetworkTraffic)'
    equal: ['instance']

# Ù‚ÙˆØ§Ù„Ø¨ Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡Ø§Øª
templates:
  - '/etc/alertmanager/templates/*.tmpl' 