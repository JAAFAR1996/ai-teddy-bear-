# [AI-Generated by Amazon Q]: ØªÙ… Ø¥Ø¶Ø§ÙØ© Ù‡Ø°Ø§ Ø§Ù„ÙƒÙˆØ¯ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ ÙˆÙÙ‚ Ø¯Ù„ÙŠÙ„ Ø§Ù„Ù…Ø´Ø±ÙˆØ¹.
import openai
from enum import Enum
from typing import Dict, Optional, List
import json
import random
from datetime import datetime

class GameType(Enum):
    TRIVIA = "trivia"
    STORY_ADVENTURE = "Ù…ØºØ§Ù…Ø±Ø©_Ù‚ØµØµÙŠØ©"
    SOUND_IMITATION = "ØªÙ‚Ù„ÙŠØ¯_Ø§Ù„Ø£ØµÙˆØ§Øª"
    RIDDLES = "Ø£Ù„ØºØ§Ø²"
    MATH_QUIZ = "ØªØ­Ø¯ÙŠ_Ø§Ù„Ø±ÙŠØ§Ø¶ÙŠØ§Øª"
    WORD_GAME = "Ù„Ø¹Ø¨Ø©_Ø§Ù„ÙƒÙ„Ù…Ø§Øª"

class GameState:
    """Ø­Ø§Ù„Ø© Ø§Ù„Ù„Ø¹Ø¨Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ©"""
    def __init__(self):
        self.game_type: Optional[GameType] = None
        self.player_name: str = ""
        self.age: int = 0
        self.score: int = 0
        self.turn: int = 0
        self.difficulty: str = "easy"
        self.history: List[Dict] = []
        self.current_question: Optional[str] = None
        self.correct_answer: Optional[str] = None

class VoiceGameEngine:
    """Ù…Ø­Ø±Ùƒ Ø§Ù„Ø£Ù„Ø¹Ø§Ø¨ Ø§Ù„ØµÙˆØªÙŠØ© Ø§Ù„ØªÙØ§Ø¹Ù„ÙŠØ©"""
    
    def __init__(self, openai_key: str):
        openai.api_key = openai_key
        self.game_state = GameState()
        self.game_prompts = self._load_game_prompts()
        
    def _load_game_prompts(self) -> Dict:
        """ØªØ­Ù…ÙŠÙ„ Ù‚ÙˆØ§Ù„Ø¨ Ø§Ù„Ø£Ù„Ø¹Ø§Ø¨"""
        return {
            GameType.TRIVIA: """Ø£Ù†Øª Ù…Ù‚Ø¯Ù… Ù„Ø¹Ø¨Ø© Ø£Ø³Ø¦Ù„Ø© Ù…Ù…ØªØ¹Ø© Ù„Ù„Ø£Ø·ÙØ§Ù„. 
            Ø§Ø·Ø±Ø­ Ø£Ø³Ø¦Ù„Ø© Ù…Ù†Ø§Ø³Ø¨Ø© Ù„Ø¹Ù…Ø± {age} Ø³Ù†ÙˆØ§Øª Ø¹Ù† {topic}.
            ÙƒÙ† Ù…Ø±Ø­Ø§Ù‹ ÙˆØ´Ø¬Ø¹ Ø§Ù„Ø·ÙÙ„ {name} Ø¹Ù„Ù‰ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø©.""",
            
            GameType.STORY_ADVENTURE: """Ø£Ù†Øª Ø±Ø§ÙˆÙŠ Ù…ØºØ§Ù…Ø±Ø© ØªÙØ§Ø¹Ù„ÙŠØ© Ù„Ù„Ø·ÙÙ„ {name}.
            Ø§Ø®Ù„Ù‚ Ù‚ØµØ© Ù…Ø«ÙŠØ±Ø© Ù…Ø¹ Ø®ÙŠØ§Ø±Ø§Øª ÙŠØ®ØªØ§Ø± Ù…Ù†Ù‡Ø§ Ø§Ù„Ø·ÙÙ„.
            ÙƒÙ„ Ø®ÙŠØ§Ø± ÙŠØ¤Ø¯ÙŠ Ù„Ù…Ø³Ø§Ø± Ù…Ø®ØªÙ„Ù ÙÙŠ Ø§Ù„Ù‚ØµØ©.""",
            
            GameType.SOUND_IMITATION: """Ø§Ù„Ø¹Ø¨ Ù„Ø¹Ø¨Ø© ØªÙ‚Ù„ÙŠØ¯ Ø§Ù„Ø£ØµÙˆØ§Øª Ù…Ø¹ {name}.
            Ø§Ø·Ù„Ø¨ ØªÙ‚Ù„ÙŠØ¯ Ø£ØµÙˆØ§Øª Ø­ÙŠÙˆØ§Ù†Ø§Øª Ø£Ùˆ Ø£Ø´ÙŠØ§Ø¡ Ù…Ø®ØªÙ„ÙØ©.
            ÙƒÙ† Ù…Ø´Ø¬Ø¹Ø§Ù‹ ÙˆØ§Ù…Ø¯Ø­ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø§Øª.""",
            
            GameType.RIDDLES: """Ø§Ø·Ø±Ø­ Ø£Ù„ØºØ§Ø²Ø§Ù‹ Ù…Ù…ØªØ¹Ø© ÙˆÙ…Ù†Ø§Ø³Ø¨Ø© Ù„Ø·ÙÙ„ Ø¹Ù…Ø±Ù‡ {age} Ø³Ù†ÙˆØ§Øª.
            Ø§Ø¨Ø¯Ø£ Ø¨Ø£Ù„ØºØ§Ø² Ø³Ù‡Ù„Ø© ÙˆØ²Ø¯ Ø§Ù„ØµØ¹ÙˆØ¨Ø© ØªØ¯Ø±ÙŠØ¬ÙŠØ§Ù‹.
            Ø£Ø¹Ø· ØªÙ„Ù…ÙŠØ­Ø§Øª Ø¥Ø°Ø§ Ø§Ø­ØªØ§Ø¬ {name} Ù„Ù„Ù…Ø³Ø§Ø¹Ø¯Ø©."""
        }
    
    def start_game(self, game_type: GameType, child_name: str, age: int, 
                   topic: str = "Ø¹Ø§Ù…") -> str:
        """Ø¨Ø¯Ø¡ Ù„Ø¹Ø¨Ø© Ø¬Ø¯ÙŠØ¯Ø©"""
        self.game_state = GameState()
        self.game_state.game_type = game_type
        self.game_state.player_name = child_name
        self.game_state.age = age
        
        # ØªØ­Ø¯ÙŠØ¯ Ù…Ø³ØªÙˆÙ‰ Ø§Ù„ØµØ¹ÙˆØ¨Ø© Ø­Ø³Ø¨ Ø§Ù„Ø¹Ù…Ø±
        if age < 5:
            self.game_state.difficulty = "very_easy"
        elif age < 8:
            self.game_state.difficulty = "easy"
        elif age < 12:
            self.game_state.difficulty = "medium"
        else:
            self.game_state.difficulty = "hard"
        
        # Ø¥Ù†Ø´Ø§Ø¡ prompt Ù„Ù„Ø¹Ø¨Ø©
        game_prompt = self.game_prompts.get(game_type, "").format(
            name=child_name,
            age=age,
            topic=topic
        )
        
        # Ø¨Ø¯Ø¡ Ø§Ù„Ù„Ø¹Ø¨Ø©
        messages = [
            {"role": "system", "content": game_prompt},
            {"role": "user", "content": f"Ø§Ø¨Ø¯Ø£ Ù„Ø¹Ø¨Ø© {game_type.value} Ø¬Ø¯ÙŠØ¯Ø©"}
        ]
        
        response = openai.ChatCompletion.create(
            model="gpt-4-turbo-preview",
            messages=messages,
            temperature=0.8,
            max_tokens=500
        )
        
        game_intro = response.choices[0].message.content
        
        # Ø­ÙØ¸ ÙÙŠ Ø§Ù„Ø³Ø¬Ù„
        self.game_state.history.append({
            'turn': 0,
            'type': 'intro',
            'content': game_intro
        })
        
        return game_intro
    
    def process_game_response(self, child_response: str) -> Dict:
        """Ù…Ø¹Ø§Ù„Ø¬Ø© Ø±Ø¯ Ø§Ù„Ø·ÙÙ„ ÙÙŠ Ø§Ù„Ù„Ø¹Ø¨Ø©"""
        self.game_state.turn += 1
        
        # ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø±Ø¯ Ø­Ø³Ø¨ Ù†ÙˆØ¹ Ø§Ù„Ù„Ø¹Ø¨Ø©
        if self.game_state.game_type == GameType.TRIVIA:
            return self._process_trivia_response(child_response)
        elif self.game_state.game_type == GameType.STORY_ADVENTURE:
            return self._process_story_response(child_response)
        elif self.game_state.game_type == GameType.SOUND_IMITATION:
            return self._process_sound_response(child_response)
        elif self.game_state.game_type == GameType.RIDDLES:
            return self._process_riddle_response(child_response)
        else:
            return self._process_generic_response(child_response)
    
    def _process_trivia_response(self, response: str) -> Dict:
        """Ù…Ø¹Ø§Ù„Ø¬Ø© Ø±Ø¯ ÙÙŠ Ù„Ø¹Ø¨Ø© Ø§Ù„Ø£Ø³Ø¦Ù„Ø©"""
        # Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø©
        is_correct = self._check_answer(response)
        
        if is_correct:
            self.game_state.score += 10
            feedback = random.choice([
                "Ø±Ø§Ø¦Ø¹! Ø¥Ø¬Ø§Ø¨Ø© ØµØ­ÙŠØ­Ø©! ðŸŽ‰",
                "Ù…Ù…ØªØ§Ø² ÙŠØ§ Ø¨Ø·Ù„! âœ¨",
                "Ø£Ø­Ø³Ù†Øª! Ù‡Ø°Ø§ ØµØ­ÙŠØ­ ØªÙ…Ø§Ù…Ø§Ù‹! ðŸŒŸ"
            ])
        else:
            feedback = random.choice([
                "Ù…Ø­Ø§ÙˆÙ„Ø© Ø¬ÙŠØ¯Ø©! Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© Ø§Ù„ØµØ­ÙŠØ­Ø© Ù‡ÙŠ...",
                "Ù‚Ø±ÙŠØ¨ Ø¬Ø¯Ø§Ù‹! Ø¯Ø¹Ù†ÙŠ Ø£Ø®Ø¨Ø±Ùƒ Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø©...",
                "Ù„Ø§ Ø¨Ø£Ø³ØŒ Ø³Ù†ØªØ¹Ù„Ù… Ù…Ø¹Ø§Ù‹!"
            ])
        
        # Ø³Ø¤Ø§Ù„ Ø¬Ø¯ÙŠØ¯
        next_question = self._generate_next_question()
        
        return {
            'feedback': feedback,
            'score': self.game_state.score,
            'next_question': next_question,
            'turn': self.game_state.turn
        }
    
    def _check_answer(self, response: str) -> bool:
        """ÙØ­Øµ ØµØ­Ø© Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø©"""
        # Ù…Ù†Ø·Ù‚ Ø¨Ø³ÙŠØ· Ù„Ù„ÙØ­Øµ - ÙŠÙ…ÙƒÙ† ØªØ­Ø³ÙŠÙ†Ù‡
        return len(response.strip()) > 0
    
    def _generate_next_question(self) -> str:
        """ØªÙˆÙ„ÙŠØ¯ Ø§Ù„Ø³Ø¤Ø§Ù„ Ø§Ù„ØªØ§Ù„ÙŠ"""
        return "Ù…Ø§ Ù‡Ùˆ Ù„ÙˆÙ†Ùƒ Ø§Ù„Ù…ÙØ¶Ù„ØŸ"
    
    def _process_story_response(self, response: str) -> Dict:
        """Ù…Ø¹Ø§Ù„Ø¬Ø© Ø±Ø¯ ÙÙŠ Ø§Ù„Ù…ØºØ§Ù…Ø±Ø© Ø§Ù„Ù‚ØµØµÙŠØ©"""
        return {'story_continuation': 'ØªØ³ØªÙ…Ø± Ø§Ù„Ù…ØºØ§Ù…Ø±Ø©...'}
    
    def _process_sound_response(self, response: str) -> Dict:
        """Ù…Ø¹Ø§Ù„Ø¬Ø© Ø±Ø¯ ÙÙŠ Ù„Ø¹Ø¨Ø© Ø§Ù„Ø£ØµÙˆØ§Øª"""
        return {'sound_feedback': 'ØµÙˆØª Ø±Ø§Ø¦Ø¹!'}
    
    def _process_riddle_response(self, response: str) -> Dict:
        """Ù…Ø¹Ø§Ù„Ø¬Ø© Ø±Ø¯ ÙÙŠ Ø§Ù„Ø£Ù„ØºØ§Ø²"""
        return {'riddle_feedback': 'Ø¥Ø¬Ø§Ø¨Ø© Ø°ÙƒÙŠØ©!'}
    
    def _process_generic_response(self, response: str) -> Dict:
        """Ù…Ø¹Ø§Ù„Ø¬Ø© Ø±Ø¯ Ø¹Ø§Ù…"""
        return {'generic_response': 'Ø´ÙƒØ±Ø§Ù‹ Ù„Ùƒ!'}
    
    def get_game_summary(self) -> Dict:
        """Ù…Ù„Ø®Øµ Ø§Ù„Ù„Ø¹Ø¨Ø©"""
        return {
            'game_type': self.game_state.game_type.value if self.game_state.game_type else None,
            'player': self.game_state.player_name,
            'final_score': self.game_state.score,
            'total_turns': self.game_state.turn,
            'history': self.game_state.history
        }
    
    def end_game(self) -> str:
        """Ø¥Ù†Ù‡Ø§Ø¡ Ø§Ù„Ù„Ø¹Ø¨Ø©"""
        summary = self.get_game_summary()
        
        # Ø±Ø³Ø§Ù„Ø© Ø®ØªØ§Ù…ÙŠØ©
        ending_message = f"""
        Ø§Ù†ØªÙ‡Øª Ø§Ù„Ù„Ø¹Ø¨Ø©! ðŸŽ®
        
        Ø£Ø­Ø³Ù†Øª ÙŠØ§ {self.game_state.player_name}!
        Ø­ØµÙ„Øª Ø¹Ù„Ù‰ {self.game_state.score} Ù†Ù‚Ø·Ø©
        
        Ù‡Ù„ ØªØ±ÙŠØ¯ Ù„Ø¹Ø¨ Ù„Ø¹Ø¨Ø© Ø£Ø®Ø±Ù‰ØŸ
        """
        
        # Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø­Ø§Ù„Ø© Ø§Ù„Ù„Ø¹Ø¨Ø©
        self.game_state = GameState()
        
        return ending_message

# Requires: pip install openai