#!/usr/bin/env python3
"""
๐ง ุญู ุงููุดุงูู - ูุญุงูู ุงูุฏุจุฏูุจ ุงูุฐูู
=====================================
ุณูุฑูุจุช ูุญู ุงููุดุงูู ุงูุดุงุฆุนุฉ ููุญุต ุงููุธุงู
"""

import sys
import subprocess
import platform
import socket
import requests
from datetime import datetime

def ูุญุต_python():
    """ูุญุต ุฅุตุฏุงุฑ Python"""
    print("๐ ูุญุต Python...")
    version = sys.version_info
    if version.major >= 3 and version.minor >= 8:
        print(f"โ Python {version.major}.{version.minor}.{version.micro} - ููุชุงุฒ!")
        return True
    else:
        print(f"โ Python {version.major}.{version.minor}.{version.micro} - ูุญุชุงุฌ Python 3.8+")
        return False

def ูุญุต_ุงูููุชุจุงุช():
    """ูุญุต ุงูููุชุจุงุช ุงููุทููุจุฉ"""
    print("\n๐ ูุญุต ุงูููุชุจุงุช...")
    
    ููุชุจุงุช_ูุทููุจุฉ = [
        "tkinter",
        "httpx", 
        "asyncio",
        "threading"
    ]
    
    ููุชุจุงุช_ูุงูุตุฉ = []
    
    for ููุชุจุฉ in ููุชุจุงุช_ูุทููุจุฉ:
        try:
            if ููุชุจุฉ == "tkinter":
                import tkinter
            elif ููุชุจุฉ == "httpx":
                import httpx
            elif ููุชุจุฉ == "asyncio":
                import asyncio
            elif ููุชุจุฉ == "threading":
                import threading
            
            print(f"โ {ููุชุจุฉ} - ูุชููุฑุฉ")
        except ImportError:
            print(f"โ {ููุชุจุฉ} - ุบูุฑ ูุชููุฑุฉ")
            ููุชุจุงุช_ูุงูุตุฉ.append(ููุชุจุฉ)
    
    return ููุชุจุงุช_ูุงูุตุฉ

def ุชุซุจูุช_ุงูููุชุจุงุช(ููุชุจุงุช_ูุงูุตุฉ):
    """ุชุซุจูุช ุงูููุชุจุงุช ุงููุงูุตุฉ"""
    if not ููุชุจุงุช_ูุงูุตุฉ:
        return True
    
    print(f"\n๐พ ุชุซุจูุช ุงูููุชุจุงุช ุงููุงูุตุฉ: {', '.join(ููุชุจุงุช_ูุงูุตุฉ)}")
    
    for ููุชุจุฉ in ููุชุจุงุช_ูุงูุตุฉ:
        if ููุชุจุฉ == "tkinter":
            print("โ๏ธ tkinter ูุฃุชู ูุน Python ุนุงุฏุฉ. ุฌุฑุจ ุฅุนุงุฏุฉ ุชุซุจูุช Python")
            continue
        
        try:
            print(f"๐ฆ ุชุซุจูุช {ููุชุจุฉ}...")
            subprocess.check_call([sys.executable, "-m", "pip", "install", ููุชุจุฉ])
            print(f"โ ุชู ุชุซุจูุช {ููุชุจุฉ}")
        except subprocess.CalledProcessError:
            print(f"โ ูุดู ุชุซุจูุช {ููุชุจุฉ}")
            return False
    
    return True

def ูุญุต_ุงูุงุชุตุงู():
    """ูุญุต ุงูุงุชุตุงู ุจุงูุฅูุชุฑูุช ูุงูุฎุงุฏู"""
    print("\n๐ ูุญุต ุงูุงุชุตุงู...")
    
    # ูุญุต ุงูุฅูุชุฑูุช
    try:
        socket.create_connection(("8.8.8.8", 53), timeout=3)
        print("โ ุงูุงุชุตุงู ุจุงูุฅูุชุฑูุช - ูุนูู")
    except OSError:
        print("โ ุงูุงุชุตุงู ุจุงูุฅูุชุฑูุช - ูุง ูุนูู")
        return False
    
    # ูุญุต ุงูุฎุงุฏู
    try:
        response = requests.get("https://ai-teddy-bear.onrender.com/health", timeout=10)
        if response.status_code == 200:
            print("โ ุฎุงุฏู ุงูุฏุจุฏูุจ ุงูุฐูู - ูุนูู")
            data = response.json()
            print(f"   ๐ ุงููุณุฎุฉ: {data.get('version', 'ุบูุฑ ูุนุฑูู')}")
            print(f"   ๐ ุงูุญุงูุฉ: {data.get('status', 'ุบูุฑ ูุนุฑูู')}")
            return True
        else:
            print(f"โ๏ธ ุฎุงุฏู ุงูุฏุจุฏูุจ ุงูุฐูู - ูุดููุฉ ({response.status_code})")
            return False
    except Exception as e:
        print(f"โ ุฎุงุฏู ุงูุฏุจุฏูุจ ุงูุฐูู - ูุง ูุนูู ({e})")
        return False

def ูุญุต_ุงููููุงุช():
    """ูุญุต ูุฌูุฏ ุงููููุงุช ุงููุทููุจุฉ"""
    print("\n๐ ูุญุต ุงููููุงุช...")
    
    ูููุงุช_ูุทููุจุฉ = [
        "ูุญุงูู_ุงูุฏุจุฏูุจ_ุงูุฐูู.py",
        "ุชุดุบูู_ุงููุญุงูู.bat", 
        "ุชุนูููุงุช_ุงููุญุงูู.md"
    ]
    
    import os
    ุฌููุน_ุงููููุงุช_ููุฌูุฏุฉ = True
    
    for ููู in ูููุงุช_ูุทููุจุฉ:
        if os.path.exists(ููู):
            print(f"โ {ููู} - ููุฌูุฏ")
        else:
            print(f"โ {ููู} - ุบูุฑ ููุฌูุฏ")
            ุฌููุน_ุงููููุงุช_ููุฌูุฏุฉ = False
    
    return ุฌููุน_ุงููููุงุช_ููุฌูุฏุฉ

def ุชุดุบูู_ุงููุญุงูู():
    """ูุญุงููุฉ ุชุดุบูู ุงููุญุงูู"""
    print("\n๐ ูุญุงููุฉ ุชุดุบูู ุงููุญุงูู...")
    
    try:
        subprocess.Popen([sys.executable, "ูุญุงูู_ุงูุฏุจุฏูุจ_ุงูุฐูู.py"])
        print("โ ุชู ุชุดุบูู ุงููุญุงูู ุจูุฌุงุญ!")
        return True
    except Exception as e:
        print(f"โ ูุดู ุชุดุบูู ุงููุญุงูู: {e}")
        return False

def ุชูุฑูุฑ_ุงููุธุงู():
    """ุฅูุดุงุก ุชูุฑูุฑ ุนู ุญุงูุฉ ุงููุธุงู"""
    print("\n๐ ุชูุฑูุฑ ุงููุธุงู:")
    print(f"   ๐ฅ๏ธ ูุธุงู ุงูุชุดุบูู: {platform.system()} {platform.release()}")
    print(f"   ๐ Python: {sys.version}")
    print(f"   โฐ ุงูููุช: {datetime.now().strftime('%Y-%m-%d %H:%M:%S')}")

def main():
    """ุงูุฏุงูุฉ ุงูุฑุฆูุณูุฉ"""
    print("๐ง ุญู ุงููุดุงูู - ูุญุงูู ุงูุฏุจุฏูุจ ุงูุฐูู")
    print("=" * 50)
    
    ุชูุฑูุฑ_ุงููุธุงู()
    
    # ูุญุต Python
    if not ูุญุต_python():
        print("\nโ ูุฑุฌู ุชุญุฏูุซ Python ุฅูู ุฅุตุฏุงุฑ 3.8 ุฃู ุฃุญุฏุซ")
        return
    
    # ูุญุต ุงูููุชุจุงุช
    ููุชุจุงุช_ูุงูุตุฉ = ูุญุต_ุงูููุชุจุงุช()
    if ููุชุจุงุช_ูุงูุตุฉ:
        ุฌูุงุจ = input(f"\nโ ูู ุชุฑูุฏ ุชุซุจูุช ุงูููุชุจุงุช ุงููุงูุตุฉุ (y/n): ")
        if ุฌูุงุจ.lower() in ['y', 'yes', 'ูุนู']:
            if not ุชุซุจูุช_ุงูููุชุจุงุช(ููุชุจุงุช_ูุงูุตุฉ):
                print("โ ูุดู ุชุซุจูุช ุจุนุถ ุงูููุชุจุงุช")
                return
        else:
            print("โ๏ธ ูู ูุนูู ุงููุญุงูู ุจุฏูู ุงูููุชุจุงุช ุงููุทููุจุฉ")
            return
    
    # ูุญุต ุงููููุงุช
    if not ูุญุต_ุงููููุงุช():
        print("โ ุจุนุถ ุงููููุงุช ููููุฏุฉ. ุชุฃูุฏ ูู ูุฌูุฏ ุฌููุน ุงููููุงุช")
        return
    
    # ูุญุต ุงูุงุชุตุงู
    ูุญุต_ุงูุงุชุตุงู()
    
    # ูุญุงููุฉ ุชุดุบูู ุงููุญุงูู
    print("\n" + "=" * 50)
    ุฌูุงุจ = input("โ ูู ุชุฑูุฏ ุชุดุบูู ุงููุญุงูู ุงูุขูุ (y/n): ")
    if ุฌูุงุจ.lower() in ['y', 'yes', 'ูุนู']:
        ุชุดุบูู_ุงููุญุงูู()
    
    print("\n๐ ุงูุชูู ูุญุต ุงููุธุงู!")
    print("๐ ุฑุงุฌุน 'ุชุนูููุงุช_ุงููุญุงูู.md' ูููุฒูุฏ ูู ุงููุณุงุนุฏุฉ")

if __name__ == "__main__":
    try:
        main()
    except KeyboardInterrupt:
        print("\n\n๐ ุชู ุฅููุงู ุงููุญุต ุจูุงุณุทุฉ ุงููุณุชุฎุฏู")
    except Exception as e:
        print(f"\nโ ุฎุทุฃ ุบูุฑ ูุชููุน: {e}")
    
    input("\nุงุถุบุท Enter ููุฎุฑูุฌ...") 